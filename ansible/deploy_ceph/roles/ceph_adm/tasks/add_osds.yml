---
- name: Apply new OSDs to the cluster
  ansible.builtin.command:
    cmd: ceph orch daemon add osd {{ item }}:/dev/{{ device_name }}
  register: apply_osd
  loop: "{{ groups['ceph_adm'] + groups['ceph_common'] }}"
  changed_when: apply_osd.stdout is defined and 'Created osd' in apply_osd.stdout

- name: Create OSD pool
  ansible.builtin.shell:
    cmd: |
      ceph osd pool create {{ item }} 16
      ceph osd pool application enable {{ item }} rbd
      rbd pool init {{ item }}
  loop:
    - images
    - volumes
  changed_when: false
